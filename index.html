<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For My Favorite</title>
    <style>
        body, html { margin: 0; padding: 0; background: #050505; overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; user-select: none; }
        canvas { position: absolute; top: 0; left: 0; z-index: 1; }
        
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; z-index: 1000; background: #000; }
        .login-panel { background: rgba(255,255,255,0.95); padding: 30px; border-radius: 30px; text-align: center; width: 85%; max-width: 320px; }
        input { padding: 15px; border-radius: 12px; border: 2px solid #eee; width: 100%; box-sizing: border-box; margin-bottom: 20px; text-align: center; font-size: 18px; outline: none; }
        .login-panel button { background: #222; color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; }

        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .main-title { color: white; font-size: clamp(24px, 8vw, 40px); font-weight: bold; margin-bottom: 15px; text-align: center; text-shadow: 0 0 15px white; }
        .balance-box { color: white; font-size: 20px; margin-bottom: 25px; background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 20px; border: 1px solid white; }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 90%; max-width: 450px; }
        .btn { background: rgba(255, 255, 255, 0.1); border: 2px solid white; color: white; padding: 20px 5px; border-radius: 15px; cursor: pointer; text-align: center; font-weight: bold; font-size: 14px; backdrop-filter: blur(10px); }

        .overlay { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.98); padding: 20px; border-radius: 25px; border: 2px solid white; z-index: 200; display: none; text-align: center; width: 90vw; max-width: 400px; color: white; }
        .close-btn { margin-top: 15px; padding: 8px 15px; border-radius: 10px; border: none; background: white; font-weight: bold; cursor: pointer; }

        .m-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; min-height: 200px; position: relative; }
        .card { aspect-ratio: 3/4; cursor: pointer; position: relative; transform-style: preserve-3d; transition: 0.5s; }
        .card.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 8px; border: 1px solid white; display: flex; align-items: center; justify-content: center; }
        .card-back { background: #222; font-size: 24px; }
        .card-front { transform: rotateY(180deg); overflow: hidden; }
        .card-front img { width: 100%; height: 100%; object-fit: cover; }

        .snow-particle { position: absolute; background: white; border-radius: 50%; pointer-events: none; z-index: 205; }
        
        #m-ctrl { position: fixed; top: 20px; right: 20px; z-index: 1100; width: 50px; height: 50px; background: rgba(255,255,255,0.3); border: 2px solid white; border-radius: 50%; display: none; align-items: center; justify-content: center; color: white; cursor: pointer; font-size: 24px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); background: rgba(255,255,255,0.5); } 100% { transform: scale(1); } }

        #catch-area { width: 100%; height: 350px; background: #111; position: relative; overflow: hidden; border-radius: 15px; margin: 10px 0; border: 1px solid #333; }
        .target { position: absolute; width: 60px; height: 60px; border-radius: 50%; border: 2px solid white; overflow: hidden; cursor: pointer; }
        .target img { width: 100%; height: 100%; object-fit: cover; }

        #photo-clicker { width: 140px; height: 140px; margin: 15px auto; cursor: pointer; border-radius: 50%; border: 4px solid white; overflow: hidden; }
        #photo-clicker img { width: 100%; height: 100%; object-fit: cover; }
        .bar { width: 100%; height: 12px; background: #333; border-radius: 10px; overflow: hidden; margin-top: 10px; }
        #fill { width: 0%; height: 100%; background: #ff4d4d; }

        #maze { width: 280px; height: 280px; background: #111; margin: 10px auto; position: relative; border: 2px solid #555; }
        .wall { position: absolute; background: white; }
        #dot { position: absolute; width: 18px; height: 18px; background: #00f0ff; border-radius: 50%; z-index: 10; }

        #special-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; color: black; padding: 25px; border-radius: 25px; text-align: center; display: none; z-index: 3000; }
    </style>
</head>
<body>

<div id="m-ctrl" onclick="toggleM()">üîá</div>

<div id="login-screen">
    <div class="login-panel">
        <h2>–í–•–û–î</h2>
        <input type="password" id="pw" placeholder="–ü–∞—Ä–æ–ª—å">
        <button onclick="doLogin()">–í–û–ô–¢–ò</button>
    </div>
</div>

<canvas id="snow"></canvas>
<div id="ui-layer">
    <div class="main-title">–ò–ì–†–´ –î–õ–Ø –õ–Æ–ë–ò–ú–û–ô</div>
    <div class="balance-box">–ë–∞–ª–∞–Ω—Å: <span id="bal">0</span> –ü–ë</div>
    <div class="menu-grid">
        <div class="btn" onclick="openG1()">–ò–ì–†–ê 1<br>–§–æ—Ç–æ-–ø–∞—Ä—ã</div>
        <div class="btn" onclick="openG2()">–ò–ì–†–ê 2<br>–õ–æ–≤–ª—è —Ñ–æ—Ç–æ</div>
        <div class="btn" onclick="openG3()">–ò–ì–†–ê 3<br>–†–∞—Å–ø–∞–∫–æ–≤–∫–∞</div>
        <div class="btn" onclick="openG4()">–ò–ì–†–ê 4<br>–õ–∞–±–∏—Ä–∏–Ω—Ç</div>
    </div>
</div>

<div id="ov1" class="overlay"><h3>–ù–ê–ô–î–ò –ü–ê–†–´</h3><div class="m-grid" id="g1-grid"></div><button class="close-btn" onclick="closeAll()">–ó–ê–ö–†–´–¢–¨</button></div>
<div id="ov2" class="overlay"><h3>–õ–û–í–ò –§–û–¢–û</h3><div id="catch-area"></div><p id="c-count">–°–æ–±—Ä–∞–Ω–æ: 0</p><button class="close-btn" onclick="stopG2()">–ó–ê–ö–†–´–¢–¨</button></div>
<div id="ov3" class="overlay">
    <h3 style="font-size: 15px;">–ñ–ú–ò –ë–´–°–¢–†–ï–ï!</h3>
    <p id="t3">–í—Ä–µ–º—è: 10</p>
    <div id="photo-clicker" onpointerdown="tapG()"><img src="img/02.jpg"></div>
    <div class="bar"><div id="fill"></div></div>
</div>
<div id="ov4" class="overlay"><h3>–î–û–ô–î–ò –î–û ‚ù§Ô∏è</h3><div id="maze"><div id="dot"></div><div id="goal" style="position:absolute; bottom:10px; right:10px; font-size:24px;">‚ù§Ô∏è</div></div><button class="close-btn" onclick="closeAll()">–ó–ê–ö–†–´–¢–¨</button></div>

<div id="special-popup">
    <div style="font-size:50px;">ü§ó</div>
    <div style="font-size:24px; font-weight:bold; margin-top:10px;">–º–∏–ª–µ–Ω—å–∫–∏–µ –º–æ–∏</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
let money = 0, g2Int, taps = 0, timer3;
let audio = new Audio();
// –°–∞–º–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–æ–º–∞–Ω—Ç–∏—á–Ω–∞—è –º–µ–ª–æ–¥–∏—è (Piano)
audio.src = "https://www.chosic.com/wp-content/uploads/2021/04/Warm-Memories-Emotional-Inspiring-Piano.mp3";
audio.loop = true;
audio.crossOrigin = "anonymous";

function doLogin() {
    const p = document.getElementById('pw').value;
    if(p === '012330' || p === '2009') {
        document.getElementById('login-screen').style.display='none';
        document.getElementById('ui-layer').style.display='flex';
        document.getElementById('m-ctrl').style.display='flex';
        
        // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º—É–∑—ã–∫—É –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ
        tryToPlay();
    } else { alert("–ù–µ–≤–µ—Ä–Ω–æ"); }
}

function tryToPlay() {
    audio.play().then(() => {
        document.getElementById('m-ctrl').innerText = 'üîä';
        document.getElementById('m-ctrl').style.animation = 'none';
    }).catch(() => {
        // –ï—Å–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ, –∫–Ω–æ–ø–∫–∞ –±—É–¥–µ—Ç –º–∏–≥–∞—Ç—å
        document.getElementById('m-ctrl').innerText = 'üîá';
    });
}

function toggleM() {
    if(audio.paused) { 
        audio.play(); 
        document.getElementById('m-ctrl').innerText='üîä';
        document.getElementById('m-ctrl').style.animation = 'none';
    } else { 
        audio.pause(); 
        document.getElementById('m-ctrl').innerText='üîá'; 
    }
}

// –°–Ω–µ–≥ –Ω–∞ —Ñ–æ–Ω–µ
const canvas = document.getElementById('snow'), ctx = canvas.getContext('2d');
let w = canvas.width = innerWidth, h = canvas.height = innerHeight;
const flakes = Array.from({length: 100}, () => ({ x: Math.random()*w, y: Math.random()*h, r: Math.random()*2+1, v: Math.random()*1+0.5 }));
function draw() {
    ctx.clearRect(0,0,w,h); ctx.fillStyle="white";
    flakes.forEach(f => { f.y += f.v; if(f.y > h) f.y = -10; ctx.beginPath(); ctx.arc(f.x, f.y, f.r, 0, Math.PI*2); ctx.fill(); });
    requestAnimationFrame(draw);
}
draw();

// –ê–Ω–∏–º–∞—Ü–∏—è —Ä–∞—Å–ø–∞–¥–∞ –≤ —Å–Ω–µ–≥ (–ò–≥—Ä–∞ 1)
function disintegrateToSnow(element) {
    const rect = element.getBoundingClientRect();
    for (let i = 0; i < 25; i++) {
        const p = document.createElement('div');
        p.className = 'snow-particle';
        const size = Math.random() * 4 + 2;
        p.style.width = size + 'px'; p.style.height = size + 'px';
        p.style.left = (rect.left + Math.random() * rect.width) + 'px';
        p.style.top = (rect.top + Math.random() * rect.height) + 'px';
        document.body.appendChild(p);
        gsap.to(p, {
            x: (Math.random() - 0.5) * 200,
            y: rect.height + Math.random() * 200,
            opacity: 0,
            duration: 2,
            onComplete: () => p.remove()
        });
    }
    gsap.to(element, { opacity: 0, scale: 0, duration: 0.5 });
}

function openG1() {
    closeAll(); document.getElementById('ov1').style.display='block';
    const grid = document.getElementById('g1-grid'); grid.innerHTML = '';
    const imgs = ['img/1.jpeg', 'img/1.jpeg', 'img/2.jpeg', 'img/2.jpeg', 'img/3.jpeg', 'img/3.jpeg', 'img/4.jpeg', 'img/4.jpeg'].sort(() => Math.random() - 0.5);
    let flipped = [];
    let found = 0;
    imgs.forEach(src => {
        const c = document.createElement('div'); c.className = 'card';
        c.innerHTML = `<div class="card-face card-back">‚ùÑÔ∏è</div><div class="card-face card-front"><img src="${src}"></div>`;
        c.onclick = () => {
            if(flipped.length < 2 && !c.classList.contains('flipped') && !c.dataset.done) {
                c.classList.add('flipped'); flipped.push(c);
                if(flipped.length === 2) {
                    if(flipped[0].querySelector('img').src === flipped[1].querySelector('img').src) {
                        money += 20; updateBal(); found++;
                        const pair = [...flipped]; flipped = [];
                        setTimeout(() => {
                            pair.forEach(card => { card.dataset.done="true"; disintegrateToSnow(card); });
                            if(found === 4) setTimeout(closeAll, 1200);
                        }, 500);
                    } else { setTimeout(() => { flipped.forEach(i=>i.classList.remove('flipped')); flipped=[]; }, 800); }
                }
            }
        };
        grid.appendChild(c);
    });
}

function openG2() {
    closeAll(); document.getElementById('ov2').style.display='block';
    const area = document.getElementById('catch-area'); area.innerHTML = '';
    let count = 0;
    const myPhotos = ['img/1.jpeg', 'img/2.jpeg', 'img/3.jpeg', 'img/4.jpeg', 'img/5.jpeg', 'img/02.jpg'];
    g2Int = setInterval(() => {
        const t = document.createElement('div'); t.className = 'target';
        t.style.left = Math.random()*80+'%'; t.style.top = '-70px';
        t.innerHTML = `<img src="${myPhotos[Math.floor(Math.random()*myPhotos.length)]}">`;
        area.appendChild(t);
        gsap.to(t, { y: 450, rotation: 360, duration: 2.5, ease:"none", onComplete: () => t.remove() });
        t.onpointerdown = () => { money+=5; updateBal(); count++; document.getElementById('c-count').innerText=`–°–æ–±—Ä–∞–Ω–æ: ${count}`; t.remove(); };
    }, 700);
}
function stopG2() { clearInterval(g2Int); closeAll(); }

function openG3() {
    closeAll(); taps = 0; document.getElementById('ov3').style.display='block';
    document.getElementById('fill').style.width = '0%';
    let left = 10; document.getElementById('t3').innerText = `–í—Ä–µ–º—è: ${left}`;
    timer3 = setInterval(() => {
        left--; document.getElementById('t3').innerText = `–í—Ä–µ–º—è: ${left}`;
        if(left <= 0) { clearInterval(timer3); if(taps < 40) { closeAll(); alert("–ë—ã—Å—Ç—Ä–µ–µ! ‚ù§Ô∏è"); } }
    }, 1000);
}
function tapG() {
    if(taps >= 40) return;
    taps++; document.getElementById('fill').style.width = (taps/40)*100 + '%';
    if(taps >= 40) {
        clearInterval(timer3); money += 100; updateBal(); document.getElementById('ov3').style.display='none';
        const p = document.getElementById('special-popup'); p.style.display = 'block';
        gsap.fromTo(p, {scale:0, opacity:0}, {scale:1, opacity:1, duration:0.5});
        setTimeout(() => { gsap.to(p, {opacity:0, scale:0, onComplete:()=>p.style.display='none'}); }, 3000);
    }
}

const dot = document.getElementById('dot'), maze = document.getElementById('maze');
function openG4() {
    closeAll(); document.getElementById('ov4').style.display='block';
    dot.style.left = '5px'; dot.style.top = '5px';
    maze.querySelectorAll('.wall').forEach(w=>w.remove());
    [{t:60,l:0,w:200,h:10},{t:130,l:80,w:200,h:10},{t:200,l:0,w:200,h:10}].forEach(d=>{
        const w = document.createElement('div'); w.className='wall';
        Object.assign(w.style, {top:d.t+'px', left:d.l+'px', width:d.w+'px', height:d.h+'px'});
        maze.appendChild(w);
    });
}
maze.onpointermove = (e) => {
    const r = maze.getBoundingClientRect();
    const x = (e.clientX || (e.touches && e.touches[0].clientX)) - r.left - 10;
    const y = (e.clientY || (e.touches && e.touches[0].clientY)) - r.top - 10;
    if(x>0 && x<260 && y>0 && y<260) {
        dot.style.left = x+'px'; dot.style.top = y+'px';
        if(x>230 && y>230) { money += 150; updateBal(); closeAll(); }
    }
};

function closeAll() {
    document.querySelectorAll('.overlay').forEach(o => o.style.display='none');
    clearInterval(g2Int); clearInterval(timer3);
}
function updateBal() { document.getElementById('bal').innerText = money; }
window.onresize = () => { w = canvas.width = innerWidth; h = canvas.height = innerHeight; };
</script>
</body>
</html>
