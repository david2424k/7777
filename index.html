<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>For My Favorite</title>
    <style>
        body, html { margin: 0; padding: 0; background: #050505; overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; user-select: none; }
        canvas { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none; will-change: transform; }
        
        #login-screen { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 1000; background: #000; }
        .login-panel { background: rgba(255,255,255,0.95); padding: 30px; border-radius: 30px; text-align: center; width: 85%; max-width: 320px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input { padding: 15px; border-radius: 12px; border: 2px solid #eee; width: 100%; box-sizing: border-box; margin-bottom: 20px; text-align: center; font-size: 18px; outline: none; -webkit-appearance: none; }
        .login-panel button { background: #222; color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; active { opacity: 0.7; } }

        #ui-layer { position: absolute; inset: 0; z-index: 10; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .main-title { color: white; font-size: clamp(24px, 8vw, 40px); font-weight: bold; margin-bottom: 15px; text-align: center; text-shadow: 0 0 15px white; }
        .balance-box { color: white; font-size: 20px; margin-bottom: 25px; background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 20px; border: 1px solid white; backdrop-filter: blur(5px); }
        
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 90%; max-width: 450px; }
        .btn { background: rgba(255, 255, 255, 0.1); border: 2px solid white; color: white; padding: 20px 5px; border-radius: 15px; cursor: pointer; text-align: center; font-weight: bold; font-size: 14px; backdrop-filter: blur(10px); will-change: transform; }
        .btn:active { transform: scale(0.95); }

        #music-btn { position: fixed; top: 20px; right: 20px; z-index: 2000; background: rgba(255,255,255,0.2); border: 1px solid white; color: white; width: 44px; height: 44px; border-radius: 50%; display: none; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(5px); }

        .overlay { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.98); padding: 20px; border-radius: 25px; border: 2px solid white; z-index: 200; display: none; text-align: center; width: 90vw; max-width: 400px; color: white; }
        .close-btn { margin-top: 15px; padding: 12px 25px; border-radius: 12px; border: none; background: white; font-weight: bold; cursor: pointer; color: black; }

        .m-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; }
        .card { aspect-ratio: 3/4; cursor: pointer; position: relative; transform-style: preserve-3d; transition: transform 0.5s; will-change: transform; }
        .card.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 8px; border: 1px solid white; display: flex; align-items: center; justify-content: center; }
        .card-back { background: #222; font-size: 24px; }
        .card-front { transform: rotateY(180deg); overflow: hidden; background: #000; }
        .card-front img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        .snow-particle { position: absolute; background: white; border-radius: 50%; pointer-events: none; z-index: 205; will-change: transform; }

        #photo-clicker { width: 140px; height: 140px; margin: 15px auto; cursor: pointer; border-radius: 50%; border: 4px solid white; overflow: hidden; touch-action: manipulation; }
        #photo-clicker img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        .bar { width: 100%; height: 12px; background: #333; border-radius: 10px; overflow: hidden; margin-top: 10px; }
        #fill { width: 0%; height: 100%; background: #ff4d4d; transition: width 0.1s; }

        #maze { width: 280px; height: 280px; background: #0a0a0a; margin: 10px auto; position: relative; border: 2px solid #ff85a2; border-radius: 10px; touch-action: none; }
        .wall { position: absolute; background: #ff85a2; box-shadow: 0 0 8px #ff85a2; }
        #dot { position: absolute; width: 20px; height: 20px; background: #fff; border-radius: 50%; z-index: 10; box-shadow: 0 0 10px #fff; will-change: transform; }

        #win-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); background: white; color: black; padding: 30px; border-radius: 30px; text-align: center; display: none; z-index: 3000; width: 260px; box-shadow: 0 0 50px rgba(255,255,255,0.3); }
        #special-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; color: black; padding: 25px; border-radius: 25px; text-align: center; display: none; z-index: 3000; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-panel">
        <h2>–í–•–û–î</h2>
        <input type="password" id="pw" placeholder="–ü–∞—Ä–æ–ª—å" inputmode="numeric">
        <button onpointerdown="doLogin()">–í–û–ô–¢–ò</button>
    </div>
</div>

<div id="music-btn" onpointerdown="toggleMusic()">üéµ</div>
<audio id="bg-music" loop preload="auto">
    <source src="music/bg.mp3" type="audio/mpeg">
</audio>

<div id="win-popup">
    <h2 style="color:#ff4d4d;">–ü–û–ë–ï–î–ê! ‚ù§Ô∏è</h2>
    <p>–¢—ã –¥–æ—à–ª–∞ –¥–æ –º–æ–µ–≥–æ —Å–µ—Ä–¥—Ü–∞!</p>
    <div style="font-size: 50px; margin: 10px 0;">ü•∞</div>
    <button class="close-btn" style="background: #222; color: white; width: 100%;" onpointerdown="closeWinPopup()">–°–£–ü–ï–†!</button>
</div>

<canvas id="snow"></canvas>

<div id="ui-layer">
    <div class="main-title">–ò–ì–†–´ –î–õ–Ø –õ–Æ–ë–ò–ú–û–ô</div>
    <div class="balance-box">–ë–∞–ª–∞–Ω—Å: <span id="bal">0</span> –ü–ë</div>
    <div class="menu-grid">
        <div class="btn" onpointerdown="openG1()">–ò–ì–†–ê 1<br>–§–æ—Ç–æ-–ø–∞—Ä—ã</div>
        <div class="btn" onpointerdown="openG2()">–ò–ì–†–ê 2<br>–õ–æ–≤–ª—è —Ñ–æ—Ç–æ</div>
        <div class="btn" onpointerdown="openG3()">–ò–ì–†–ê 3<br>–†–∞—Å–ø–∞–∫–æ–≤–∫–∞</div>
        <div class="btn" onpointerdown="openG4()">–ò–ì–†–ê 4<br>–õ–∞–±–∏—Ä–∏–Ω—Ç</div>
    </div>
</div>

<div id="ov1" class="overlay"><h3>–ù–ê–ô–î–ò –ü–ê–†–´</h3><div class="m-grid" id="g1-grid"></div><button class="close-btn" onpointerdown="closeAll()">–ó–ê–ö–†–´–¢–¨</button></div>
<div id="ov2" class="overlay"><h3>–õ–û–í–ò –§–û–¢–û</h3><div id="catch-area" style="height:320px; position:relative; overflow:hidden; background:#111; border-radius:15px; touch-action:none;"></div><p id="c-count">–°–æ–±—Ä–∞–Ω–æ: 0</p><button class="close-btn" onpointerdown="stopG2()">–ó–ê–ö–†–´–¢–¨</button></div>
<div id="ov3" class="overlay">
    <h3 style="font-size: 15px; color:#ff85a2;">–¢–≤–æ—ë —Å–µ—Ä–¥–µ—á–∫–æ –±—å—ë—Ç—Å—è —Ä–∞–¥–∏ –º–µ–Ω—è?<br>–î–æ–∫–∞–∂–∏ —ç—Ç–æ —á–∞—Å—Ç—ã–º–∏ –∫–∞—Å–∞–Ω–∏—è–º–∏! ‚ù§Ô∏è</h3>
    <p id="t3">–í—Ä–µ–º—è –ª—é–±–≤–∏: 10</p>
    <div id="photo-clicker" onpointerdown="tapG()"><img src="img/02.jpg"></div>
    <div class="bar"><div id="fill"></div></div>
</div>
<div id="ov4" class="overlay">
    <h3>–î–û–ô–î–ò –î–û –°–ï–†–î–¶–ê ‚ù§Ô∏è</h3>
    <div id="maze"><div id="dot"></div><div id="goal-heart" style="position:absolute; bottom:5px; right:5px; font-size:24px;">‚ù§Ô∏è</div></div>
    <button class="close-btn" onpointerdown="closeAll()">–ó–ê–ö–†–´–¢–¨</button>
</div>

<div id="special-popup">
    <div style="font-size:50px;">ü§ó</div>
    <div style="font-size:20px; font-weight:bold; margin-top:10px;">–º–∏–ª–µ–Ω—å–∫–∏–µ –º–æ–∏</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
let money = 0, g2Int, taps = 0, timer3;
const allPhotos = ['img/1.jpeg', 'img/2.jpeg', 'img/3.jpeg', 'img/4.jpeg', 'img/5.jpeg', 'img/02.jpg'];
const music = document.getElementById('bg-music');
const mBtn = document.getElementById('music-btn');

function doLogin() {
    const val = document.getElementById('pw').value;
    if(val === '012330' || val === '2009') {
        document.getElementById('login-screen').style.display='none';
        document.getElementById('ui-layer').style.display='flex';
        mBtn.style.display = 'flex';
        music.play().catch(() => {});
    } else alert("–ù–µ–≤–µ—Ä–Ω–æ");
}

function toggleMusic() {
    if (music.paused) { music.play(); mBtn.innerText = 'üéµ'; }
    else { music.pause(); mBtn.innerText = 'üîá'; }
}

// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–Ω–µ–≥
const canvas = document.getElementById('snow'), ctx = canvas.getContext('2d');
let w = canvas.width = innerWidth, h = canvas.height = innerHeight;
let flakes = Array.from({length: 50}, () => ({ 
    x: Math.random()*w, y: Math.random()*h, r: Math.random()*2+1, v: Math.random()*1+0.5, offset: Math.random()*10
}));

function drawSnow() {
    ctx.clearRect(0,0,w,h); 
    ctx.fillStyle="white";
    for(let i=0; i<flakes.length; i++) {
        let f = flakes[i];
        f.y += f.v;
        f.x += Math.sin(f.y/30 + f.offset) * 0.5; // –ü–ª–∞–≤–Ω–æ–µ –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ
        if(f.y > h) f.y = -10;
        ctx.beginPath(); ctx.arc(f.x, f.y, f.r, 0, Math.PI*2); ctx.fill();
    }
    requestAnimationFrame(drawSnow);
}
drawSnow();

function disintegrate(el) {
    const r = el.getBoundingClientRect();
    for(let i=0; i<15; i++){
        const p = document.createElement('div'); p.className = 'snow-particle';
        p.style.width = p.style.height = Math.random()*5+2+'px';
        p.style.left = r.left + Math.random()*r.width+'px'; p.style.top = r.top + Math.random()*r.height+'px';
        document.body.appendChild(p);
        gsap.to(p, { x: (Math.random()-0.5)*150, y: 150, opacity: 0, duration: 1, onComplete: () => p.remove() });
    }
    gsap.to(el, { opacity: 0, scale: 0.5, duration: 0.4 });
}

function openG1() {
    closeAll(); document.getElementById('ov1').style.display='block';
    const grid = document.getElementById('g1-grid'); grid.innerHTML = '';
    const imgs = [allPhotos[0], allPhotos[0], allPhotos[1], allPhotos[1], allPhotos[2], allPhotos[2], allPhotos[3], allPhotos[3]].sort(() => Math.random() - 0.5);
    let flipped = [];
    imgs.forEach(src => {
        const c = document.createElement('div'); c.className = 'card';
        c.innerHTML = `<div class="card-face card-back">‚ùÑÔ∏è</div><div class="card-face card-front"><img src="${src}"></div>`;
        c.onpointerdown = (e) => {
            if(flipped.length < 2 && !c.classList.contains('flipped')) {
                c.classList.add('flipped'); flipped.push(c);
                if(flipped.length === 2) {
                    if(flipped[0].querySelector('img').src === flipped[1].querySelector('img').src) {
                        money += 20; updateBal();
                        const p = [...flipped]; flipped = [];
                        setTimeout(() => p.forEach(card => disintegrate(card)), 500);
                    } else setTimeout(() => { flipped.forEach(i=>i.classList.remove('flipped')); flipped=[]; }, 700);
                }
            }
        };
        grid.appendChild(c);
    });
}

function openG2() {
    closeAll(); document.getElementById('ov2').style.display='block';
    const area = document.getElementById('catch-area'); area.innerHTML = '';
    let count = 0;
    g2Int = setInterval(() => {
        const t = document.createElement('div'); t.style.cssText = "position:absolute; width:60px; height:60px; border-radius:50%; border:2px solid white; overflow:hidden; will-change: transform;";
        t.style.left = Math.random()*80+'%'; t.style.top = '-70px';
        t.innerHTML = `<img src="${allPhotos[Math.floor(Math.random()*allPhotos.length)]}" style="width:100%;height:100%;object-fit:cover;">`;
        area.appendChild(t);
        gsap.to(t, { y: 450, duration: 2.5, ease: "none", onComplete: () => t.remove() });
        t.onpointerdown = (e) => { e.preventDefault(); money+=5; count++; updateBal(); document.getElementById('c-count').innerText=`–°–æ–±—Ä–∞–Ω–æ: ${count}`; t.remove(); };
    }, 750);
}
function stopG2() { clearInterval(g2Int); closeAll(); }

function openG3() {
    closeAll(); taps = 0; document.getElementById('ov3').style.display='block';
    document.getElementById('fill').style.width = '0%';
    let left = 10; timer3 = setInterval(() => { left--; document.getElementById('t3').innerText = `–í—Ä–µ–º—è –ª—é–±–≤–∏: ${left}`; if(left <= 0) { clearInterval(timer3); closeAll(); } }, 1000);
}
function tapG() {
    taps++; 
    const fill = document.getElementById('fill');
    fill.style.width = (Math.min(taps, 40)/40)*100 + '%';
    gsap.fromTo("#photo-clicker", {scale:0.95}, {scale:1, duration:0.1});
    if(taps === 40) { 
        clearInterval(timer3); money += 100; updateBal(); closeAll(); 
        const p = document.getElementById('special-popup'); p.style.display = 'block';
        setTimeout(() => p.style.display = 'none', 2000);
    }
}

function openG4() {
    closeAll(); document.getElementById('ov4').style.display='block';
    dot.style.left='5px'; dot.style.top='5px';
    const maze = document.getElementById('maze');
    maze.querySelectorAll('.wall').forEach(w=>w.remove());
    [{t:70,l:0,w:200,h:12},{t:150,l:80,w:200,h:12},{t:220,l:0,w:200,h:12}].forEach(d => {
        const w = document.createElement('div'); w.className='wall';
        Object.assign(w.style, {top:d.t+'px', left:d.l+'px', width:d.w+'px', height:d.h+'px'});
        maze.appendChild(w);
    });
}

document.getElementById('maze').onpointermove = (e) => {
    if(document.getElementById('ov4').style.display !== 'block') return;
    const r = e.currentTarget.getBoundingClientRect();
    const x = e.clientX - r.left - 10;
    const y = e.clientY - r.top - 10;
    if(x > 0 && x < 260 && y > 0 && y < 260) {
        dot.style.left = x+'px'; dot.style.top = y+'px';
        if(x > 230 && y > 230) { money += 150; updateBal(); showWinPopup(); }
    }
};

function showWinPopup() {
    const p = document.getElementById('win-popup'); p.style.display = 'block';
    gsap.to(p, { scale: 1, duration: 0.5, ease: "back.out(1.7)" });
}
function closeWinPopup() {
    gsap.to("#win-popup", { scale: 0, duration: 0.3, onComplete: () => { document.getElementById('win-popup').style.display = 'none'; closeAll(); }});
}
function closeAll() { document.querySelectorAll('.overlay').forEach(o => o.style.display='none'); clearInterval(g2Int); clearInterval(timer3); }
function updateBal() { document.getElementById('bal').innerText = money; }

window.addEventListener('resize', () => { w = canvas.width = innerWidth; h = canvas.height = innerHeight; });
</script>
</body>
</html>
